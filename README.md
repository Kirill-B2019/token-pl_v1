# Система управления цифровыми активами (Токен-Платформа)

## Описание

Автоматизированная система для управления цифровыми токенами с поддержкой покупки, продажи и управления для участников: заказчика, клиентов, брокера и банка-эквайера.

## Основные возможности

### Модуль клиента
- Регистрация с присвоением уникального 10-символьного ID
- Личный кабинет с просмотром баланса токенов и истории операций
- Покупка токенов (выбор пакета, оплата картой)
- Продажа токенов (заявка, автоматический расчет по рыночному курсу)

### Модуль брокера
- Управление резервом токенов (пополнение при дефиците через биржи)
- Перевод токенов клиентам после оплаты
- Контроль списаний при продаже токенов
- Интеграция с криптобиржами

### Модуль банка-эквайера
- Обработка платежей/возвратов через API
- Перевод средств на счета брокера/клиентов
- Верификация транзакций

### Административный модуль
- Формирование списков победителей/проигравших
- Инициирование обратного выкупа токенов
- Мониторинг операций в реальном времени
- Управление пользователями и системой

## Технические требования

- PHP 8.2+
- Laravel 12
- MySQL/PostgreSQL
- Redis (для кэширования)
- Node.js (для сборки фронтенда)

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd token-pl
```

2. Установите зависимости:
```bash
composer install
npm install
```

3. Настройте окружение:
```bash
cp .env.example .env
php artisan key:generate
```

4. Настройте базу данных в `.env`:
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=token_platform
DB_USERNAME=your_username
DB_PASSWORD=your_password
```

5. Выполните миграции:
```bash
php artisan migrate
```

6. Заполните базу данных тестовыми данными:
```bash
php artisan db:seed
```

7. Соберите фронтенд:
```bash
npm run build
```

8. Запустите сервер:
```bash
php artisan serve
```

## Структура проекта

```
app/
├── Http/
│   ├── Controllers/
│   │   ├── ClientController.php      # Контроллер клиента
│   │   ├── BrokerController.php      # Контроллер брокера
│   │   ├── AdminController.php       # Административный контроллер
│   │   └── Api/                      # API контроллеры
│   │       ├── BrokerApiController.php
│   │       ├── BankApiController.php
│   │       └── ExchangeApiController.php
│   └── Middleware/
│       └── CheckRole.php             # Middleware для проверки ролей
├── Models/
│   ├── User.php                      # Модель пользователя
│   ├── Token.php                     # Модель токена
│   ├── Transaction.php               # Модель транзакции
│   ├── Broker.php                    # Модель брокера
│   ├── Bank.php                      # Модель банка
│   ├── TokenPackage.php              # Модель пакета токенов
│   ├── UserBalance.php               # Модель баланса пользователя
│   ├── WinnerLoser.php               # Модель победителей/проигравших
│   └── AuditLog.php                  # Модель аудита
database/
├── migrations/                       # Миграции базы данных
└── seeders/                         # Сидеры для тестовых данных
routes/
├── web.php                          # Web маршруты
└── api.php                          # API маршруты
```

## API Документация

### Брокер API

#### Получить баланс токена
```
GET /api/broker/token-balance
```

Параметры:
- `api_key` (string) - API ключ брокера
- `token_symbol` (string) - Символ токена

#### Перевести токены
```
POST /api/broker/transfer
```

Параметры:
- `api_key` (string) - API ключ брокера
- `user_id` (integer) - ID пользователя
- `token_symbol` (string) - Символ токена
- `amount` (float) - Количество токенов
- `transaction_id` (string) - ID транзакции

### Банк API

#### Обработать платеж
```
POST /api/bank/payment
```

Параметры:
- `merchant_id` (string) - ID мерчанта
- `api_key` (string) - API ключ
- `transaction_id` (string) - ID транзакции
- `amount` (float) - Сумма
- `currency` (string) - Валюта
- `card_number` (string) - Номер карты
- `expiry_date` (string) - Срок действия
- `cvv` (string) - CVV код
- `cardholder_name` (string) - Имя держателя карты

### Биржа API

#### Получить цену токена
```
GET /api/exchange/price
```

Параметры:
- `api_key` (string) - API ключ брокера
- `token_symbol` (string) - Символ токена

## Безопасность

- Двухфакторная аутентификация (SMS/Google Authenticator)
- Шифрование данных: TLS 1.3 для передачи, AES-256 для хранения
- Контроль доступа: RBAC (ролевая модель: клиент, брокер, администратор)
- Аудит: логирование всех операций с immutable-хранилищем

## Роли пользователей

### Клиент (client)
- Покупка и продажа токенов
- Просмотр баланса и истории транзакций
- Управление профилем

### Брокер (broker)
- Управление резервом токенов
- Обработка транзакций
- Интеграция с биржами

### Администратор (admin)
- Управление пользователями
- Создание токенов
- Формирование списков победителей/проигравших
- Мониторинг системы

## Контрольные точки и проверки

### Обязательные проверки
- Перед сделкой: доступность токенов у брокера
- При оплате: верификация банком-эквайером
- После перевода: подтверждение зачисления токенов/средств

### Регулярный аудит
- Ежедневная сверка балансов участников
- Авторасчет комиссий и налогов

## Тестирование

Запуск тестов:
```bash
php artisan test
```

## Лицензия

Этот проект является коммерческим продуктом и защищен авторскими правами.

## Поддержка

Для получения поддержки обращайтесь к администратору системы.
